Backport of #3038 to 1.23

Error on cherry-picking: 63f9121f95eb3e4b4ec8b9678391e3de2ae940e2

To continue do:
```bash
git fetch && \
  git checkout ghci/backport/3038-to-1.23 && \
  git reset --hard HEAD^ && \
  git cherry-pick 63f9121f95eb3e4b4ec8b9678391e3de2ae940e2
git push origin ghci/backport/3038-to-1.23 --force
```