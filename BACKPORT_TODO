Backport of #3127 to 1.21

Error on cherry-picking: 4ef920d921d10a6868e98180bb79c98264cc079e, b64dcf7f60c3578cbfb4e87ddbbfdfc1a5dd6c03

To continue do:
```bash
git fetch && \
  git checkout ghci/backport/3127-to-1.21 && \
  git reset --hard HEAD^ && \
  git cherry-pick 4ef920d921d10a6868e98180bb79c98264cc079e b64dcf7f60c3578cbfb4e87ddbbfdfc1a5dd6c03
git push origin ghci/backport/3127-to-1.21 --force
```