{
    "$schema": "http://json-schema.org/draft-07/schema",
    "$id": "https://raw.githubusercontent.com/camptocamp/tilecloud-chain/master/tilecloud_chain/schema.json",
    "type": "object",
    "title": "TileCloud-chain configuration",
    "additionalProperties": false,
    "definitions": {
        "grid": {
            "title": "Grid",
            "description": "The WMTS grid definition, see https://github.com/camptocamp/tilecloud-chain/blob/master/tilecloud_chain/USAGE.rst#configure-grids",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "resolution_scale": {
                    "title": "Resolution scale",
                    "description": "The scale used to build a FreeTileGrid typically '2'",
                    "type": "integer"
                },
                "resolutions": {
                    "title": "Resolutions",
                    "description": "The resolutions in pixel per meter",
                    "type": "array",
                    "items": {
                        "type": "number"
                    }
                },
                "bbox": {
                    "title": "Bounding box",
                    "description": "The bounding box in meter",
                    "type": "array",
                    "items": {
                        "type": "number"
                    },
                    "minLength": 4,
                    "maxLength": 4
                },
                "srs": {
                    "title": "SRS",
                    "description": "The projection reference",
                    "type": "string",
                    "pattern": "^EPSG:[0-9]+$"
                },
                "proj4_literal": {
                    "title": "Proj4 literal",
                    "description": "The Proj4 definition",
                    "type": "string"
                },
                "unit": {
                    "title": "Unit",
                    "description": "The projection unit, default to 'm'",
                    "type": "string"
                },
                "tile_size": {
                    "title": "Tile size",
                    "description": "The tile size in pixel, default to 256",
                    "type": "integer"
                },
                "matrix_identifier": {
                    "title": "Matrix identifier",
                    "description": "The identifier to use in the tiles URL, recommend to be resolution (default)",
                    "type": "string",
                    "enum": ["zoom", "resolution"]
                }
            },
            "required": ["resolutions", "bbox", "srs"]
        },
        "cache_type": {
            "title": "Cache type",
            "description": "The cache type, s3, filesystem, mbtiles or bsddb",
            "type": "string",
            "enum": ["s3", "filesystem", "mbtiles", "bsddb"]
        },
        "cache_wmtscapabilities_file": {
            "title": "Cache WMST capabilities file",
            "description": "The generated WMTS capabilities file name (by 'default 1.0.0/WMTSCapabilities.xml')",
            "type": "string"
        },
        "cache_http_url": {
            "title": "Cache HTTP URL",
            "description": "The HTTP URL %host will be replaces by one of the hosts",
            "type": "string"
        },
        "cache_hosts": {
            "title": "Cache host",
            "description": "The host used to build the HTTP URLs",
            "type": "array",
            "items": {
                "type": "string"
            }
        },
        "cache_http_urls": {
            "title": "Cache HTTP URLs",
            "type": "array",
            "items": {
                "type": "string"
            }
        },
        "cache_folder": {
            "title": "Cache folder",
            "description": "The root folder of the cache, default to ''",
            "type": "string"
        },
        "cache_filesystem": {
            "additionalProperties": {
                "type": "string"
            },
            "properties": {
                "type": { "$ref": "#/definitions/cache_type" },
                "wmtscapabilities_file": { "$ref": "#/definitions/cache_wmtscapabilities_file" },
                "http_url": { "$ref": "#/definitions/cache_http_url" },
                "hosts": { "$ref": "#/definitions/cache_hosts" },
                "http_urls": { "$ref": "#/definitions/cache_http_urls" },
                "folder": { "$ref": "#/definitions/cache_folder" }
            }
        },
        "cache_s3": {
            "additionalProperties": {
                "type": "string"
            },
            "properties": {
                "type": { "$ref": "#/definitions/cache_type" },
                "wmtscapabilities_file": { "$ref": "#/definitions/cache_wmtscapabilities_file" },
                "http_url": { "$ref": "#/definitions/cache_http_url" },
                "hosts": { "$ref": "#/definitions/cache_hosts" },
                "http_urls": { "$ref": "#/definitions/cache_http_urls" },
                "tiles_url": {
                    "title": "Tiles URL",
                    "description": "The template tiles URL on S3, the argument can be region, bucket and folder (default is 'http://s3-{region}.amazonaws.com/{bucket}/{folder}')",
                    "type": "string"
                },
                "host": {
                    "title": "Host",
                    "description": "The S3 host, default to 's3-eu-west-1.amazonaws.com'",
                    "type": "string"
                },
                "bucket": {
                    "title": "Bucket",
                    "description": "The S3 bucker name",
                    "type": "string"
                },
                "region": {
                    "$ref": "#/definitions/aws_region"
                },
                "cache_control": {
                    "title": "Cache control",
                    "description": "The Cache-Control used to store tiles on S3",
                    "type": "string"
                }
            },
            "required": ["bucket"]
        },
        "cache_mbtiles": {
            "additionalProperties": {
                "type": "string"
            },
            "properties": {
                "type": { "$ref": "#/definitions/cache_type" },
                "wmtscapabilities_file": {
                    "$ref": "#/definitions/cache_wmtscapabilities_file"
                },
                "http_url": { "$ref": "#/definitions/cache_http_url" },
                "hosts": { "$ref": "#/definitions/cache_hosts" },
                "http_urls": { "$ref": "#/definitions/cache_http_urls" },
                "folder": { "$ref": "#/definitions/cache_folder" }
            }
        },
        "cache_bsddb": {
            "additionalProperties": {
                "type": "string"
            },
            "properties": {
                "type": { "$ref": "#/definitions/cache_type" },
                "wmtscapabilities_file": {
                    "$ref": "#/definitions/cache_wmtscapabilities_file"
                },
                "http_url": { "$ref": "#/definitions/cache_http_url" },
                "hosts": { "$ref": "#/definitions/cache_hosts" },
                "http_urls": { "$ref": "#/definitions/cache_http_urls" },
                "folder": { "$ref": "#/definitions/cache_folder" }
            }
        },
        "cache": {
            "title": "Cache",
            "description": "The tiles cache definition, see https://github.com/camptocamp/tilecloud-chain/blob/master/tilecloud_chain/USAGE.rst#configure-caches",
            "type": "object",
            "if": {
                "properties": { "type": { "const": "filesystem" } }
            },
            "then": {
                "$ref": "#/definitions/cache_filesystem"
            },
            "else": {
                "if": {
                    "properties": { "type": { "const": "s3" } }
                },
                "then": {
                    "$ref": "#/definitions/cache_s3"
                },
                "else": {
                    "if": {
                        "properties": { "type": { "const": "mbtiles" } }
                    },
                    "then": {
                        "$ref": "#/definitions/cache_mbtiles"
                    },
                    "else": {
                        "if": {
                            "properties": { "type": { "const": "bsddb" } }
                        },
                        "then": {
                            "$ref": "#/definitions/cache_bsddb"
                        },
                        "else": {
                            "properties": {
                                "type": { "$ref": "#/definitions/cache_type" }
                            }
                        },
                        "required": ["type"]
                    }
                }
            }
        },
        "layer_type": {
            "title": "Layer type",
            "description": "The layer type, wms or mapnik",
            "type": "string",
            "enum": ["wms", "mapnik"]
        },
        "layer_title": {
            "title": "Layer title",
            "description": "The title, use to generate the capabilities",
            "type": "string"
        },
        "layer_grid": {
            "title": "Layer grid",
            "description": "The used grid name",
            "type": "string"
        },
        "layer_bbox": {
            "title": "Layer bounding box",
            "description": "The bounding box where we will generate the tiles",
            "type": "array",
            "items": {
                "type": "number"
            },
            "minLength": 4,
            "maxLength": 4
        },
        "layer_min_resolution_seed": {
            "title": "layer min resolution seed",
            "description": "The minimum resolutions to pre-generate",
            "type": "number"
        },
        "layer_px_buffer": {
            "title": "Layer pixel buffer",
            "description": "The buffer in pixel used to calculate geometry intersection, default to 0",
            "type": "number"
        },
        "layer_meta": {
            "title": "Layer meta",
            "description": "Used meta-tiles, default to False, see see https://github.com/camptocamp/tilecloud-chain/blob/master/tilecloud_chain/USAGE.rst#meta-tiles",
            "type": "boolean"
        },
        "layer_meta_size": {
            "title": "Layer meta size",
            "description": "The meta-tile size in tiles, default to 5",
            "type": "integer"
        },
        "layer_meta_buffer": {
            "title": "Layer meta buffer",
            "description": "The meta-tiles buffer in pixels, default to 128",
            "type": "integer"
        },
        "layer_layers": {
            "title": "Layer layers",
            "description": "The WMS layers",
            "type": "string"
        },
        "layer_wmts_style": {
            "title": "Layer WMTS style",
            "description": "The WMTS style",
            "type": "string",
            "pattern": "^[a-zA-Z0-9_\\-\\+~\\.]+$"
        },
        "layer_mime_type": {
            "title": "Layer MIME type",
            "description": "The MIME type of the tiles",
            "type": "string",
            "pattern": "^[a-zA-Z0-9!#$%^&\\*_\\-\\+{}\\|'.`~]+/[a-zA-Z0-9!#$%^&\\*_\\-\\+{}\\|'.`~]+$"
        },
        "layer_extension": {
            "title": "Layer extension",
            "description": "The layer extension",
            "type": "string"
        },
        "layer_dimension_name": {
            "title": "Layer dimension name",
            "description": "The dimension name",
            "type": "string",
            "pattern": "^(?!(?i)(SERVICE|VERSION|REQUEST|LAYERS|STYLES|SRS|CRS|BBOX|WIDTH|HEIGHT|FORMAT|BGCOLOR|TRANSPARENT|SLD|EXCEPTIONS|SALT))[a-z0-9_\\-~\\.]+$"
        },
        "layer_dimensions": {
            "title": "layer dimensions",
            "description": "The WMTS dimensions",
            "type": "array",
            "items": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                    "name": {
                        "$ref": "#/definitions/layer_dimension_name"
                    },
                    "generate": {
                        "title": "Generate",
                        "description": "The values that should be generate",
                        "type": "array",
                        "items": {
                            "type": "string",
                            "pattern": "^[a-zA-Z0-9_\\-\\+~\\.]+$"
                        }
                    },
                    "values": {
                        "title": "Values",
                        "description": "The values present in the capabilities",
                        "type": "array",
                        "items": {
                            "type": "string",
                            "pattern": "^[a-zA-Z0-9_\\-\\+~\\.]+$"
                        }
                    },
                    "default": {
                        "title": "Default",
                        "description": "The default value present in the capabilities",
                        "type": "string",
                        "pattern": "^[a-zA-Z0-9_\\-\\+~\\.]+$"
                    }
                },
                "required": ["name", "generate", "values", "default"]
            }
        },
        "layer_legends": {
            "title": "Layer legends",
            "description": "The provided legend",
            "type": "array",
            "items": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                    "mime_type": {
                        "title": "MIME type",
                        "description": "The mime type used in the WMS request",
                        "type": "string",
                        "pattern": "^[a-zA-Z0-9!#$%^&\\*_\\-\\+{}\\|'.`~]+/[a-zA-Z0-9!#$%^&\\*_\\-\\+{}\\|'.`~]+$"
                    },
                    "href": {
                        "title": "Href",
                        "description": "The URL of the legend image",
                        "type": "string"
                    },
                    "width": {
                        "title": "Width",
                        "description": "The width of the legend image",
                        "type": "string"
                    },
                    "height": {
                        "title": "Height",
                        "description": "The height of the legend image",
                        "type": "string"
                    },
                    "min_scale": {
                        "title": "Min scale",
                        "description": "The max scale of the legend image",
                        "type": "string"
                    },
                    "max_scale": {
                        "title": "Max scale",
                        "description": "The max scale of the legend image",
                        "type": "string"
                    },
                    "min_resolution": {
                        "title": "Min resolution",
                        "description": "The max resolution of the legend image",
                        "type": "string"
                    },
                    "max_resolution": {
                        "title": "Max resolution",
                        "description": "The max resolution of the legend image",
                        "type": "string"
                    }
                },
                "required": ["mime_type", "href"]
            }
        },
        "layer_legend_mime": {
            "title": "Layer legend MIME",
            "description": "The mime type used to store the generated legend",
            "type": "string",
            "pattern": "^[a-zA-Z0-9!#$%^&\\*_\\-\\+{}\\|'.`~]+/[a-zA-Z0-9!#$%^&\\*_\\-\\+{}\\|'.`~]+$"
        },
        "layer_legend_extension": {
            "title": "Layer legend extension",
            "description": "The extension used to store the generated legend",
            "type": "string",
            "pattern": "^[a-zA-Z0-9]+$"
        },
        "layer_pre_hash_post_process": {
            "title": "Layer pre hash post process",
            "description": "Do an image post process before the empty hash check",
            "type": "string"
        },
        "layer_post_process": {
            "title": "Layer post process",
            "description": "Do an image post process after the empty hash check",
            "type": "string"
        },
        "layer_geoms": {
            "title": "Layer geometries",
            "description": "The geometries used to determine where we should create the tiles, see https://github.com/camptocamp/tilecloud-chain/blob/master/tilecloud_chain/USAGE.rst#configure-geomsql",
            "type": "array",
            "items": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                    "connection": {
                        "title": "Connection",
                        "description": "The PostgreSQL connection string",
                        "type": "string"
                    },
                    "sql": {
                        "title": "SQL",
                        "description": "The SQL query that get the geometry in geom e.g. 'the_geom AS geom FROM my_table'",
                        "type": "string"
                    },
                    "min_resolution": {
                        "title": "Min resolution",
                        "description": "The min resolution where the query is valid",
                        "type": "number"
                    },
                    "max_resolution": {
                        "title": "Max resolution",
                        "description": "The max resolution where the query is valid",
                        "type": "number"
                    }
                },
                "required": ["connection", "sql"]
            }
        },
        "layer_empty_tile_detection": {
            "title": "Layer empty tile detection",
            "description": "The rules used to detect the empty tiles, use `generate-tiles --get-hash` to get what we can use, see https://github.com/camptocamp/tilecloud-chain/blob/master/tilecloud_chain/USAGE.rst#configure-hash",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "size": {
                    "title": "Title",
                    "description": "The tile size",
                    "type": "integer"
                },
                "hash": {
                    "title": "Hash",
                    "description": "The tile hash",
                    "type": "string"
                }
            },
            "required": ["size", "hash"]
        },
        "layer_empty_metatile_detection": {
            "title": "Layer empty meta-tile detection",
            "description": "The rules used to detect the empty meta-tiles, use `generate-tiles --get-hash` to get what we can use, see https://github.com/camptocamp/tilecloud-chain/blob/master/tilecloud_chain/USAGE.rst#configure-hash",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "size": {
                    "title": "Size",
                    "description": "The meta-tile size",
                    "type": "integer"
                },
                "hash": {
                    "title": "Hash",
                    "description": "The meta-tile hash",
                    "type": "string"
                }
            },
            "required": ["size", "hash"]
        },
        "layer_cost": {
            "title": "Layer cost",
            "description": "The rules used to calculate the cost (unmaintained)",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "tileonly_generation_time": {
                    "title": "tile only generation time",
                    "description": "The time to generate a tile without meta-tile",
                    "type": "number"
                },
                "tile_generation_time": {
                    "title": "tile generation time",
                    "description": "The time to generate a tile from the meta-tile",
                    "type": "number"
                },
                "metatile_generation_time": {
                    "title": "Meta tile generation time",
                    "description": "The time to generate a meta-tile",
                    "type": "number"
                },
                "tile_size": {
                    "title": "Tile size",
                    "description": "The tile mean size in bytes",
                    "type": "number"
                }
            }
        },
        "layer_wms": {
            "additionalProperties": false,
            "properties": {
                "type": { "$ref": "#/definitions/layer_type" },
                "title": {
                    "$ref": "#/definitions/layer_title"
                },
                "grid": {
                    "$ref": "#/definitions/layer_grid"
                },
                "bbox": {
                    "$ref": "#/definitions/layer_bbox"
                },
                "min_resolution_seed": {
                    "$ref": "#/definitions/layer_min_resolution_seed"
                },
                "px_buffer": {
                    "$ref": "#/definitions/layer_px_buffer"
                },
                "meta": {
                    "$ref": "#/definitions/layer_meta"
                },
                "meta_size": {
                    "$ref": "#/definitions/layer_meta_size"
                },
                "meta_buffer": {
                    "$ref": "#/definitions/layer_meta_buffer"
                },
                "layers": {
                    "$ref": "#/definitions/layer_layers"
                },
                "wmts_style": {
                    "$ref": "#/definitions/layer_wmts_style"
                },
                "mime_type": {
                    "$ref": "#/definitions/layer_mime_type"
                },
                "extension": {
                    "$ref": "#/definitions/layer_extension"
                },
                "dimensions": {
                    "$ref": "#/definitions/layer_dimensions"
                },
                "legends": {
                    "$ref": "#/definitions/layer_legends"
                },
                "legend_mime": {
                    "$ref": "#/definitions/layer_legend_mime"
                },
                "legend_extension": {
                    "$ref": "#/definitions/layer_legend_extension"
                },
                "pre_hash_post_process": {
                    "$ref": "#/definitions/layer_pre_hash_post_process"
                },
                "post_process": {
                    "$ref": "#/definitions/layer_post_process"
                },
                "geoms": {
                    "$ref": "#/definitions/layer_geoms"
                },
                "empty_tile_detection": {
                    "$ref": "#/definitions/layer_empty_tile_detection"
                },
                "empty_metatile_detection": {
                    "$ref": "#/definitions/layer_empty_metatile_detection"
                },
                "cost": {
                    "$ref": "#/definitions/layer_cost"
                },
                "url": {
                    "title": "URL",
                    "description": "The WMS service URL",
                    "type": "string"
                },
                "generate_salt": {
                    "title": "Generate salt",
                    "description": "Should generate a salt to drop the cache, default to False",
                    "type": "boolean"
                },
                "query_layers": {
                    "title": "Query layers",
                    "description": "The layers use for query (To be used with the server)",
                    "type": "string"
                },
                "info_formats": {
                    "title": "Info formats",
                    "description": "The query info format",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "params": {
                    "title": "Parameters",
                    "description": "Additional parameters to the WMS query (like dimension)",
                    "type": "object",
                    "additionalProperties": {
                        "description": "The parameter value",
                        "type": "string"
                    }
                },
                "headers": {
                    "title": "Headers",
                    "description": "The headers that we send to the WMS backend",
                    "type": "object",
                    "additionalProperties": {
                        "description": "The header value",
                        "type": "string"
                    }
                },
                "version": {
                    "title": "Version",
                    "description": "The used WMS version (default to '1.1.1')",
                    "type": "string"
                }
            },
            "required": ["layers", "url", "grid", "wmts_style", "mime_type", "extension"]
        },
        "layer_mapnik": {
            "additionalProperties": false,
            "properties": {
                "type": { "$ref": "#/definitions/layer_type" },
                "title": {
                    "$ref": "#/definitions/layer_title"
                },
                "grid": {
                    "$ref": "#/definitions/layer_grid"
                },
                "bbox": {
                    "$ref": "#/definitions/layer_bbox"
                },
                "min_resolution_seed": {
                    "$ref": "#/definitions/layer_min_resolution_seed"
                },
                "px_buffer": {
                    "$ref": "#/definitions/layer_px_buffer"
                },
                "meta": {
                    "$ref": "#/definitions/layer_meta"
                },
                "meta_size": {
                    "$ref": "#/definitions/layer_meta_size"
                },
                "meta_buffer": {
                    "$ref": "#/definitions/layer_meta_buffer"
                },
                "layers": {
                    "$ref": "#/definitions/layer_layers"
                },
                "wmts_style": {
                    "$ref": "#/definitions/layer_wmts_style"
                },
                "mime_type": {
                    "$ref": "#/definitions/layer_mime_type"
                },
                "extension": {
                    "$ref": "#/definitions/layer_extension"
                },
                "dimensions": {
                    "$ref": "#/definitions/layer_dimensions"
                },
                "legends": {
                    "$ref": "#/definitions/layer_legends"
                },
                "legend_mime": {
                    "$ref": "#/definitions/layer_legend_mime"
                },
                "legend_extension": {
                    "$ref": "#/definitions/layer_legend_extension"
                },
                "pre_hash_post_process": {
                    "$ref": "#/definitions/layer_pre_hash_post_process"
                },
                "post_process": {
                    "$ref": "#/definitions/layer_post_process"
                },
                "geoms": {
                    "$ref": "#/definitions/layer_geoms"
                },
                "empty_tile_detection": {
                    "$ref": "#/definitions/layer_empty_tile_detection"
                },
                "empty_metatile_detection": {
                    "$ref": "#/definitions/layer_empty_metatile_detection"
                },
                "cost": {
                    "$ref": "#/definitions/layer_cost"
                },
                "mapfile": {
                    "title": "MapFile",
                    "description": "The Mapnik map file",
                    "type": "string"
                },
                "data_buffer": {
                    "title": "Data buffer",
                    "description": "The data buffer, default to 128",
                    "type": "integer"
                },
                "output_format": {
                    "title": "Output format",
                    "description": "The Mapnik output format, default to 'png'",
                    "type": "string",
                    "enum": ["png", "png256", "jpeg", "grid"]
                },
                "wms_url": {
                    "title": "WMS URL",
                    "description": "A WMS fallback URL (deprecated)",
                    "type": "string"
                },
                "resolution": {
                    "title": "Resolution",
                    "description": "The resolution, default to 4",
                    "type": "integer"
                },
                "layers_fields": {
                    "title": "Layers fields",
                    "description": "The Mapnik layers fields",
                    "type": "object",
                    "additionalProperties": {
                        "description": "The Mapnik layer fields",
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    }
                },
                "drop_empty_utfgrid": {
                    "title": "Drop empty UTFGrid",
                    "description": "Drop if the tile is empty, default to False",
                    "type": "boolean"
                }
            },
            "required": ["grid", "wmts_style", "mime_type", "extension"]
        },
        "layer": {
            "title": "Layer",
            "description": "The layer definition, see https://github.com/camptocamp/tilecloud-chain/blob/master/tilecloud_chain/USAGE.rst#configure-layers",
            "type": "object",
            "if": {
                "properties": { "type": { "const": "wms" } }
            },
            "then": {
                "$ref": "#definitions/layer_wms"
            },
            "else": {
                "if": {
                    "properties": { "type": { "const": "mapnik" } }
                },
                "then": {
                    "$ref": "#definitions/layer_mapnik"
                },
                "else": {
                    "properties": {
                        "type": { "$ref": "#/definitions/layer_type" }
                    },
                    "required": ["type"]
                }
            }
        },
        "process": {
            "title": "Process",
            "description": "A command",
            "type": "array",
            "items": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                    "cmd": {
                        "title": "Command",
                        "description": "The shell command, available parameters: %(in)s, %(out)s, %(args)s, %(x)s, %(y)s, %(z)s.",
                        "type": "string"
                    },
                    "need_out": {
                        "title": "Need out",
                        "description": "The command will generate an output in a file, default to False",
                        "type": "boolean"
                    },
                    "arg": {
                        "title": "Argument",
                        "description": "Used to build the %(args)",
                        "type": "object",
                        "additionalProperties": false,
                        "properties": {
                            "default": {
                                "title": "Properties",
                                "description": "The arguments used by default",
                                "type": "string"
                            },
                            "verbose": {
                                "title": "Verbose",
                                "description": "The arguments used on verbose mode",
                                "type": "string"
                            },
                            "debug": {
                                "title": "Debug",
                                "description": "The arguments used on debug mode",
                                "type": "string"
                            },
                            "quiet": {
                                "title": "Quiet",
                                "description": "The arguments used on quiet mode",
                                "type": "string"
                            }
                        }
                    }
                },
                "required": ["cmd"]
            }
        },
        "generation": {
            "title": "Generation",
            "description": "The configuration used for the generation",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "default_cache": {
                    "title": "Default cache",
                    "description": "The default cache name to be used, default do 'default'",
                    "type": "string"
                },
                "default_layers": {
                    "title": "Default layers",
                    "description": "The default layers to be generated",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "log_format": {
                    "title": "Log format",
                    "description": "The logging format, default to '%(levelname)s:%(name)s:%(funcName)s:%(message)s'",
                    "type": "string"
                },
                "authorised_user": {
                    "title": "Authorised user",
                    "description": "The authorised user to generate the tiles (used to avoid permission issue on generated tiles)",
                    "type": "string"
                },
                "maxconsecutive_errors": {
                    "title": "Max consecutive errors",
                    "description": "The maximum number of consecutive errors, default to 10",
                    "type": "integer"
                },
                "error_file": {
                    "title": "Error file",
                    "description": "File name generated with the tiles in error, see https://github.com/camptocamp/tilecloud-chain/blob/master/tilecloud_chain/USAGE.rst#tiles-error-file",
                    "type": "string"
                },
                "number_process": {
                    "title": "Number process",
                    "description": "Number of process used to generate the tiles, default to 1",
                    "type": "integer"
                }
            }
        },
        "aws_region": {
            "title": "AWS region",
            "description": "The region, default to 'eu-west-1'",
            "type": "string",
            "pattern": "^(eu|us|ap|sa)-(north|south|east|west|central)(east|west)?-[1-3]$"
        },
        "redis": {
            "title": "Redis",
            "description": "The Redis configuration",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "url": {
                    "title": "URL",
                    "description": "The server URL",
                    "type": "string",
                    "pattern": "^redis://[^:]+:[^:]+$"
                },
                "sentinels": {
                    "title": "Sentinels",
                    "description": "The sentinels",
                    "type": "array",
                    "items": {
                        "description": "A sentinel",
                        "type": "array",
                        "items": [
                            {
                                "description": "The sentinel host name",
                                "type": "string"
                            },
                            {
                                "description": "The sentinel port",
                                "anyOf": [{ "type": "string" }, { "type": "integer" }]
                            }
                        ],
                        "additionalItems": false
                    }
                },
                "service_name": {
                    "title": "Service name",
                    "description": "The service name, default to 'mymaster'",
                    "type": "string"
                },
                "socket_timeout": {
                    "title": "Socket timeout",
                    "description": "The socket timeout",
                    "type": "integer"
                },
                "db": {
                    "title": "Database",
                    "type": "integer"
                },
                "queue": {
                    "title": "Queue",
                    "description": "The queue name",
                    "type": "string"
                },
                "timeout": {
                    "title": "Timeout",
                    "description": "The timeout, default to 5",
                    "type": "integer"
                },
                "pending_timeout": {
                    "title": "Pending timeout",
                    "description": "The pending timeout, default to 300",
                    "type": "integer"
                },
                "max_retries": {
                    "title": "Max retries",
                    "description": "The max retries, default to 5",
                    "type": "integer"
                },
                "max_errors_age": {
                    "title": "Max errors age",
                    "description": "The max error age, default to 86400 (1 day)",
                    "type": "integer"
                },
                "max_errors_nb": {
                    "title": "Max errors number",
                    "description": "The max error number, default to 100",
                    "type": "integer"
                },
                "prefix": {
                    "title": "Prefix",
                    "description": "The prefix, default to 'tilecloud_cache'",
                    "type": "string"
                },
                "expiration": {
                    "title": "Expiration",
                    "description": "The meta-tile in queue expiration, default to 28800 (8 hours)",
                    "type": "integer"
                }
            }
        },
        "server": {
            "title": "Server",
            "description": "Configuration used by the tile server, see https://github.com/camptocamp/tilecloud-chain/blob/master/tilecloud_chain/USAGE.rst#distribute-the-tiles",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "cache": {
                    "title": "Cache",
                    "description": "The used cache name",
                    "type": "string"
                },
                "layers": {
                    "title": "Layers",
                    "description": "Layers available in the server, default to all layers",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "geoms_redirect": {
                    "title": "Geometries redirect",
                    "description": "Take care on the geometries, default to False",
                    "type": "boolean"
                },
                "mapcache_internal": {
                    "title": "Mapcache internal",
                    "description": "Use internal mapcache, default to False",
                    "type": "boolean"
                },
                "mapcache_base": {
                    "title": "Mapcache base",
                    "description": "The base URL, default to 'http://localhost/' (deprecated)",
                    "type": "string"
                },
                "mapcache_headers": {
                    "title": "Mapcache headers",
                    "description": "The headers send to mapcahe (deprecated)",
                    "type": "object",
                    "additionalProperties": {
                        "type": "string"
                    }
                },
                "static_allow_extension": {
                    "title": "Static allow extension",
                    "description": "The allowed extension of static files, defaults to [jpeg, png, xml, js, html, css]",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "wmts_path": {
                    "title": "WMTS path",
                    "description": "The sub-path for the WMTS, default to 'wmts'",
                    "type": "string"
                },
                "static_path": {
                    "title": "Static path",
                    "description": "The sub-path for the static files, default to 'static'",
                    "type": "string"
                },
                "admin_path": {
                    "title": "Admin path",
                    "description": "The sub-path for the admin, default to 'admin'",
                    "type": "string"
                },
                "expires": {
                    "title": "Expires",
                    "description": "The browser cache expiration, default to 8 (hours)",
                    "type": "integer"
                },
                "predefined_commands": {
                    "title": "Predefined commands",
                    "description": "The predefined commands used to generate the tiles",
                    "type": "array",
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "properties": {
                            "command": {
                                "title": "Command",
                                "description": "The command to run",
                                "type": "string"
                            },
                            "name": {
                                "title": "Name",
                                "description": "The name used in the admin interface",
                                "type": "string"
                            }
                        }
                    }
                },
                "allowed_commands": {
                    "title": "Allowed commands",
                    "description": "The regular expression of authorised commands",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                }
            }
        },
        "cost": {
            "title": "Cost",
            "description": "The configuration use to calculate the cast (unmaintained)",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "request_per_layers": {
                    "title": "Request per layers",
                    "description": "Tile request per hours, default to 10 000 000",
                    "type": "integer"
                },
                "s3": {
                    "title": "S3",
                    "description": "The S3 cost",
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "storage": {
                            "title": "Storage",
                            "description": "The storage cost in $ / Gio / month",
                            "type": "number"
                        },
                        "put": {
                            "title": "Put",
                            "description": "The cost of put in $ per 10 000 requests",
                            "type": "number"
                        },
                        "get": {
                            "title": "Get",
                            "description": "The cost of get in $ per 10 000 requests",
                            "type": "number"
                        },
                        "download": {
                            "title": "Download",
                            "description": "The cost of download in $ per Gio",
                            "type": "number"
                        }
                    }
                },
                "cloudfront": {
                    "title": "CloudFront",
                    "description": "The CloudFront cost",
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "get": {
                            "title": "Get",
                            "description": "The cost of get in $ per 10 000 requests",
                            "type": "number"
                        },
                        "download": {
                            "title": "Download",
                            "description": "The cost of download in $ per Gio",
                            "type": "number"
                        }
                    }
                },
                "sqs": {
                    "title": "SQS",
                    "description": "The SQS cost, see https://github.com/camptocamp/tilecloud-chain/blob/master/tilecloud_chain/USAGE.rst#configure-sqs",
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "request": {
                            "title": "Request",
                            "description": "The cost of request in $ per 1 000 000 requests",
                            "type": "number"
                        }
                    }
                }
            }
        },
        "metadata": {
            "title": "Metadata",
            "description": "The configuration of the WMTS capabilities metadata",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "title": {
                    "title": "Title",
                    "description": "The title",
                    "type": "string"
                },
                "abstract": {
                    "title": "Abstract",
                    "description": "The abstract",
                    "type": "string"
                },
                "servicetype": {
                    "title": "Service type",
                    "description": "The service type, default is 'OGC WMTS'",
                    "type": "string"
                },
                "keywords": {
                    "title": "Keywords",
                    "description": "The keywords",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "fees": {
                    "title": "Fees",
                    "description": "The fees",
                    "type": "string"
                },
                "access_constraints": {
                    "title": "Access constraints",
                    "description": "The access constraints",
                    "type": "string"
                }
            },
            "required": ["title"]
        },
        "provider": {
            "title": "Provider",
            "description": "The provider",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "name": {
                    "title": "Name",
                    "type": "string"
                },
                "url": {
                    "title": "URL",
                    "description": "The public URL",
                    "type": "string"
                },
                "contact": {
                    "title": "Contact",
                    "description": "The contact",
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "name": {
                            "title": "Name",
                            "type": "string"
                        },
                        "position": {
                            "title": "Position",
                            "type": "string"
                        },
                        "info": {
                            "title": "Info",
                            "description": "The information",
                            "type": "object",
                            "additionalProperties": false,
                            "properties": {
                                "phone": {
                                    "title": "Phone",
                                    "description": "The phone",
                                    "type": "object",
                                    "additionalProperties": false,
                                    "properties": {
                                        "voice": {
                                            "title": "Voice",
                                            "description": "The voice number",
                                            "type": "string"
                                        },
                                        "fax": {
                                            "title": "Fax",
                                            "description": "The fax number",
                                            "type": "string"
                                        }
                                    }
                                },
                                "address": {
                                    "title": "Address",
                                    "description": "The address",
                                    "type": "object",
                                    "additionalProperties": false,
                                    "properties": {
                                        "delivery": {
                                            "title": "Delivery",
                                            "description": "The delivery",
                                            "type": "string"
                                        },
                                        "city": {
                                            "title": "City",
                                            "description": "The city",
                                            "type": "string"
                                        },
                                        "area": {
                                            "title": "Area",
                                            "description": "The area",
                                            "type": "string"
                                        },
                                        "postal_code": {
                                            "title": "Postal code",
                                            "description": "The postal code",
                                            "type": "integer"
                                        },
                                        "country": {
                                            "title": "Country",
                                            "description": "The country",
                                            "type": "string"
                                        },
                                        "email": {
                                            "title": "Email",
                                            "description": "The email",
                                            "type": "string"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "logging": {
            "title": "Logging",
            "description": "The logging configuration to database, see https://github.com/camptocamp/tilecloud-chain/blob/master/tilecloud_chain/USAGE.rst#logging",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "database": {
                    "title": "Database",
                    "description": "The database",
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "host": {
                            "title": "Host",
                            "description": "The host",
                            "type": "string"
                        },
                        "port": {
                            "title": "Port",
                            "description": "The port, default is 5432",
                            "type": "integer"
                        },
                        "dbname": {
                            "title": "Database",
                            "description": "The database name",
                            "type": "string"
                        },
                        "table": {
                            "title": "Table",
                            "description": "The table name",
                            "type": "string"
                        },
                        "user": {
                            "title": "User",
                            "description": "The user name",
                            "type": "string"
                        },
                        "password": {
                            "title": "Password",
                            "description": "The password",
                            "type": "string"
                        }
                    },
                    "required": ["dbname", "table", "user", "password"]
                }
            },
            "required": ["database"]
        }
    },
    "properties": {
        "defaults": {
            "type": "object",
            "title": "Defaults",
            "description": "Used to put YAML references"
        },
        "grids": {
            "type": "object",
            "title": "Grids",
            "description": "The WMTS grid definitions by grid name, see https://github.com/camptocamp/tilecloud-chain/blob/master/tilecloud_chain/USAGE.rst#configure-grids",
            "propertyNames": {
                "pattern": "^[a-zA-Z0-9_\\-~\\.]+$"
            },
            "additionalProperties": {
                "$ref": "#/definitions/grid"
            }
        },
        "caches": {
            "title": "Caches",
            "description": "The tiles caches definitions by name, see https://github.com/camptocamp/tilecloud-chain/blob/master/tilecloud_chain/USAGE.rst#configure-caches",
            "type": "object",
            "propertyNames": {
                "pattern": "^[a-zA-Z0-9_\\-~\\.]+$"
            },
            "additionalProperties": {
                "$ref": "#/definitions/cache"
            }
        },
        "layers": {
            "title": "Layers",
            "description": "The layers definitions by name, see https://github.com/camptocamp/tilecloud-chain/blob/master/tilecloud_chain/USAGE.rst#configure-layers",
            "type": "object",
            "propertyNames": {
                "pattern": "^[a-zA-Z0-9_\\-~\\.]+$"
            },
            "additionalProperties": {
                "$ref": "#/definitions/layer"
            }
        },
        "process": {
            "title": "Process",
            "description": "List of available commands by name, see https://github.com/camptocamp/tilecloud-chain/blob/master/tilecloud_chain/USAGE.rst#process",
            "type": "object",
            "additionalProperties": {
                "$ref": "#/definitions/process"
            }
        },
        "generation": {
            "$ref": "#/definitions/generation"
        },
        "sqs": {
            "title": "SQS",
            "description": "The Simple Queue Service configuration",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "queue": {
                    "title": "Queue",
                    "description": "The queue name, default to 'tilecloud'",
                    "type": "string"
                },
                "region": {
                    "$ref": "#/definitions/aws_region"
                }
            }
        },
        "sns": {
            "title": "SNS",
            "description": "The Simple Notification Service configuration, see https://github.com/camptocamp/tilecloud-chain/blob/master/tilecloud_chain/USAGE.rst#configure-sns",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "topic": {
                    "title": "Topic",
                    "description": "The topic",
                    "type": "string"
                },
                "region": {
                    "$ref": "#/definitions/aws_region"
                }
            },
            "required": ["topic"]
        },
        "redis": {
            "$ref": "#/definitions/redis"
        },
        "apache": {
            "title": "Apache",
            "description": "Configuration used to generate the Apache configuration (deprecated)",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "location": {
                    "type": "string"
                },
                "config_file": {
                    "type": "string"
                },
                "expires": {
                    "type": "integer"
                }
            }
        },
        "mapcache": {
            "title": "MapCache",
            "description": "Configuration used to generate the mapcache configuration (deprecated)",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "config_file": {
                    "type": "string"
                },
                "memcache_host": {
                    "type": "string"
                },
                "memcache_port": {},
                "location": {
                    "type": "string"
                }
            }
        },
        "openlayers": {
            "title": "OpenLayers",
            "description": "Configuration used to generate the OpenLayers example page",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "srs": {
                    "title": "SRS",
                    "description": "The projection code",
                    "type": "string",
                    "pattern": "^EPSG:[0-9]+$"
                },
                "center_x": {
                    "title": "Center x",
                    "description": "The center easting",
                    "type": "number"
                },
                "center_y": {
                    "title": "Center y",
                    "description": "The center northing",
                    "type": "number"
                }
            },
            "required": ["srs"]
        },
        "server": {
            "$ref": "#/definitions/server"
        },
        "cost": {
            "$ref": "#/definitions/cost"
        },
        "metadata": {
            "$ref": "#/definitions/metadata"
        },
        "provider": {
            "$ref": "#/definitions/provider"
        },
        "logging": {
            "$ref": "#/definitions/logging"
        }
    },
    "required": ["grids", "caches", "layers"]
}
