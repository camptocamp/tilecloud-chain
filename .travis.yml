language: python

python:
#- 2.6
- 2.7

before_install:
- echo 'yes' | sudo add-apt-repository ppa:mapnik/v2.1.0
- sudo apt-get update -qq
- sudo aptitude install -y -q10 libmapnik libmapnik-dev mapnik-utils postgis postgresql-9.1-postgis apache2 cgi-mapserver
- sudo -u postgres tilecloud_chain/tests/create_test_data.sh
- sudo cp tilecloud_chain/tests/apache.conf /etc/apache2/sites-enabled/apache.conf
- sudo apache2ctl graceful
- sudo chmod 777 /tmp

install:
- pip install -U mapnik2==2.1.0.1 --use-mirrors
- python bootstrap.py --version 1.5.2 --distribute --download-base
            http://pypi.camptocamp.net/distribute-0.6.22_fix-issue-227/ --setup-source
            http://pypi.camptocamp.net/distribute-0.6.22_fix-issue-227/distribute_setup.py
- ./buildout/bin/buildout

script:
- find tilecloud_chain -name \*.py | grep -v tilecloud_chain/openlayers.py | xargs ./buildout/bin/flake8 --max-line-length=120
- ./buildout/bin/python setup.py nosetests

notifications:
  email:
    recipients:
      - stephane.brunner@gmail.com
